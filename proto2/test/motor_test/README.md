# Motor Test

Test the direction and speed of two stepper motors. The pulses are generated by the ISR of timer 2 with 16kHz.

The speed of two stepper motors goes from 0 up to 150 RPM in 1 RPM step, down to 0 RPM, down to -150, and then return to 0 RPM.

# Direction

The two motors should run in the same direction. And the RPM displayed in the serial terminal should be a positive number when the wheel rotates forward. If not, modify the LOW/HIGH of DIR0 or DIR1 in motor_set_rpm() function according to your hardware.

```
digitalWrite(DIR0, LOW);
digitalWrite(DIR1, HIGH);
```

# Speed

I used timer 2 ISR to control the pulse of the stepper motor. And the stepper motor was set to micro step mode. 

We can see something to notice. 

## At a low speed

The speed is controlled by a 1 RPM resolution. 

```
...
10 RPM	= 533.33 pulse per sec (Hz)	= 30 timer tick between pulse
9 RPM	= 480.00 pulse per sec (Hz)	= 33 timer tick between pulse
8 RPM	= 426.67 pulse per sec (Hz)	= 37 timer tick between pulse
7 RPM	= 373.33 pulse per sec (Hz)	= 42 timer tick between pulse
6 RPM	= 320.00 pulse per sec (Hz)	= 50 timer tick between pulse
5 RPM	= 266.67 pulse per sec (Hz)	= 60 timer tick between pulse
4 RPM	= 213.33 pulse per sec (Hz)	= 75 timer tick between pulse
3 RPM	= 160.00 pulse per sec (Hz)	= 100 timer tick between pulse
2 RPM	= 106.67 pulse per sec (Hz)	= 150 timer tick between pulse
1 RPM	= 53.33 pulse per sec (Hz)	= 300 timer tick between pulse
-1 RPM	= 53.33 pulse per sec (Hz)	= 300 timer tick between pulse
-2 RPM	= 106.67 pulse per sec (Hz)	= 150 timer tick between pulse
-3 RPM	= 160.00 pulse per sec (Hz)	= 100 timer tick between pulse
-4 RPM	= 213.33 pulse per sec (Hz)	= 75 timer tick between pulse
-5 RPM	= 266.67 pulse per sec (Hz)	= 60 timer tick between pulse
-6 RPM	= 320.00 pulse per sec (Hz)	= 50 timer tick between pulse
-7 RPM	= 373.33 pulse per sec (Hz)	= 42 timer tick between pulse
-8 RPM	= 426.67 pulse per sec (Hz)	= 37 timer tick between pulse
-9 RPM	= 480.00 pulse per sec (Hz)	= 33 timer tick between pulse
-10 RPM	= 533.33 pulse per sec (Hz)	= 30 timer tick between pulse
...
```

## At a high speed

If the speed goes higher than 30 RPM, we cannot control the speed in the fine resolution.

For example, we can see the 34 to 37 RPM has the same timer tick, which means the resulted speed is the same as 34 RPM.

```
30 RPM	= 1600.00 pulse per sec (Hz)	= 10 timer tick between pulse
31 RPM	= 1653.33 pulse per sec (Hz)	= 9 timer tick between pulse
32 RPM	= 1706.67 pulse per sec (Hz)	= 9 timer tick between pulse
33 RPM	= 1760.00 pulse per sec (Hz)	= 9 timer tick between pulse
34 RPM	= 1813.33 pulse per sec (Hz)	= 8 timer tick between pulse
35 RPM	= 1866.67 pulse per sec (Hz)	= 8 timer tick between pulse
36 RPM	= 1920.00 pulse per sec (Hz)	= 8 timer tick between pulse
37 RPM	= 1973.33 pulse per sec (Hz)	= 8 timer tick between pulse
38 RPM	= 2026.67 pulse per sec (Hz)	= 7 timer tick between pulse
45 RPM	= 2400.00 pulse per sec (Hz)	= 6 timer tick between pulse
46 RPM	= 2453.33 pulse per sec (Hz)	= 6 timer tick between pulse
47 RPM	= 2506.67 pulse per sec (Hz)	= 6 timer tick between pulse
48 RPM	= 2560.00 pulse per sec (Hz)	= 6 timer tick between pulse
49 RPM	= 2613.33 pulse per sec (Hz)	= 6 timer tick between pulse
50 RPM	= 2666.67 pulse per sec (Hz)	= 6 timer tick between pulse
51 RPM	= 2720.00 pulse per sec (Hz)	= 5 timer tick between pulse
52 RPM	= 2773.33 pulse per sec (Hz)	= 5 timer tick between pulse
53 RPM	= 2826.67 pulse per sec (Hz)	= 5 timer tick between pulse
54 RPM	= 2880.00 pulse per sec (Hz)	= 5 timer tick between pulse
55 RPM	= 2933.33 pulse per sec (Hz)	= 5 timer tick between pulse
56 RPM	= 2986.67 pulse per sec (Hz)	= 5 timer tick between pulse
57 RPM	= 3040.00 pulse per sec (Hz)	= 5 timer tick between pulse
58 RPM	= 3093.33 pulse per sec (Hz)	= 5 timer tick between pulse
59 RPM	= 3146.67 pulse per sec (Hz)	= 5 timer tick between pulse
60 RPM	= 3200.00 pulse per sec (Hz)	= 5 timer tick between pulse
61 RPM	= 3253.33 pulse per sec (Hz)	= 4 timer tick between pulse
62 RPM	= 3306.67 pulse per sec (Hz)	= 4 timer tick between pulse
63 RPM	= 3360.00 pulse per sec (Hz)	= 4 timer tick between pulse
64 RPM	= 3413.33 pulse per sec (Hz)	= 4 timer tick between pulse
65 RPM	= 3466.67 pulse per sec (Hz)	= 4 timer tick between pulse
66 RPM	= 3520.00 pulse per sec (Hz)	= 4 timer tick between pulse
67 RPM	= 3573.33 pulse per sec (Hz)	= 4 timer tick between pulse
68 RPM	= 3626.67 pulse per sec (Hz)	= 4 timer tick between pulse
69 RPM	= 3680.00 pulse per sec (Hz)	= 4 timer tick between pulse
70 RPM	= 3733.33 pulse per sec (Hz)	= 4 timer tick between pulse
...
```

A finer timer is necessary.
